import{r as p,a as H,j as G}from"./index-e8c385b1.js";import{B as Z,V as k,M as I,F as T,u as q,a as F,T as S,b as C,E as _,c as R,O as J,_ as K,d as Q,e as Y}from"./BallCanvas-f0650264.js";function v(r){return function(l){r.forEach(function(a){typeof a=="function"?a(l):a!=null&&(a.current=l)})}}class V extends Z{constructor(l,a,y,x){super();const m=[],M=[],B=[],d=new k,E=new I;E.makeRotationFromEuler(y),E.setPosition(a);const j=new I;j.copy(E).invert(),g(),this.setAttribute("position",new T(m,3)),this.setAttribute("normal",new T(M,3)),this.setAttribute("uv",new T(B,2));function g(){let t,o=[];const n=new k,s=new k;if(l.geometry.isGeometry===!0){console.error("THREE.DecalGeometry no longer supports THREE.Geometry. Use BufferGeometry instead.");return}const e=l.geometry,A=e.attributes.position,b=e.attributes.normal;if(e.index!==null){const c=e.index;for(t=0;t<c.count;t++)n.fromBufferAttribute(A,c.getX(t)),s.fromBufferAttribute(b,c.getX(t)),O(o,n,s)}else for(t=0;t<A.count;t++)n.fromBufferAttribute(A,t),s.fromBufferAttribute(b,t),O(o,n,s);for(o=u(o,d.set(1,0,0)),o=u(o,d.set(-1,0,0)),o=u(o,d.set(0,1,0)),o=u(o,d.set(0,-1,0)),o=u(o,d.set(0,0,1)),o=u(o,d.set(0,0,-1)),t=0;t<o.length;t++){const c=o[t];B.push(.5+c.position.x/x.x,.5+c.position.y/x.y),c.position.applyMatrix4(E),m.push(c.position.x,c.position.y,c.position.z),M.push(c.normal.x,c.normal.y,c.normal.z)}}function O(t,o,n){o.applyMatrix4(l.matrixWorld),o.applyMatrix4(j),n.transformDirection(l.matrixWorld),t.push(new P(o.clone(),n.clone()))}function u(t,o){const n=[],s=.5*Math.abs(x.dot(o));for(let e=0;e<t.length;e+=3){let A,b,c,L=0,i,h,w,D;const X=t[e+0].position.dot(o)-s,$=t[e+1].position.dot(o)-s,N=t[e+2].position.dot(o)-s;switch(A=X>0,b=$>0,c=N>0,L=(A?1:0)+(b?1:0)+(c?1:0),L){case 0:{n.push(t[e]),n.push(t[e+1]),n.push(t[e+2]);break}case 1:{if(A&&(i=t[e+1],h=t[e+2],w=f(t[e],i,o,s),D=f(t[e],h,o,s)),b){i=t[e],h=t[e+2],w=f(t[e+1],i,o,s),D=f(t[e+1],h,o,s),n.push(w),n.push(h.clone()),n.push(i.clone()),n.push(h.clone()),n.push(w.clone()),n.push(D);break}c&&(i=t[e],h=t[e+1],w=f(t[e+2],i,o,s),D=f(t[e+2],h,o,s)),n.push(i.clone()),n.push(h.clone()),n.push(w),n.push(D),n.push(w.clone()),n.push(h.clone());break}case 2:{A||(i=t[e].clone(),h=f(i,t[e+1],o,s),w=f(i,t[e+2],o,s),n.push(i),n.push(h),n.push(w)),b||(i=t[e+1].clone(),h=f(i,t[e+2],o,s),w=f(i,t[e],o,s),n.push(i),n.push(h),n.push(w)),c||(i=t[e+2].clone(),h=f(i,t[e],o,s),w=f(i,t[e+1],o,s),n.push(i),n.push(h),n.push(w));break}}}return n}function f(t,o,n,s){const e=t.position.dot(n)-s,A=o.position.dot(n)-s,b=e/(e-A);return new P(new k(t.position.x+b*(o.position.x-t.position.x),t.position.y+b*(o.position.y-t.position.y),t.position.z+b*(o.position.z-t.position.z)),new k(t.normal.x+b*(o.normal.x-t.normal.x),t.normal.y+b*(o.normal.y-t.normal.y),t.normal.z+b*(o.normal.z-t.normal.z)))}}}class P{constructor(l,a){this.position=l,this.normal=a}clone(){return new this.constructor(this.position.clone(),this.normal.clone())}}const U=r=>r===Object(r)&&!Array.isArray(r)&&typeof r!="function";function W(r,l){const a=q(x=>x.gl),y=F(S,U(r)?Object.values(r):r);if(p.useLayoutEffect(()=>{l==null||l(y)},[l]),p.useEffect(()=>{(Array.isArray(y)?y:[y]).forEach(a.initTexture)},[a,y]),U(r)){const x=Object.keys(r),m={};return x.forEach(M=>Object.assign(m,{[M]:y[x.indexOf(M)]})),m}else return y}W.preload=r=>F.preload(S,r);W.clear=r=>F.clear(S,r);function tt(r){return Array.isArray(r)}function z(r=[0,0,0]){return tt(r)?r:r instanceof k||r instanceof _?[r.x,r.y,r.z]:[r,r,r]}const ot=p.forwardRef(function({debug:l,mesh:a,children:y,position:x,rotation:m,scale:M,...B},d){const E=p.useRef(null);p.useImperativeHandle(d,()=>E.current);const j=p.useRef(null);return p.useLayoutEffect(()=>{const g=(a==null?void 0:a.current)||E.current.parent,O=E.current;if(!(g instanceof C))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');const u={position:new k,rotation:new _,scale:new k(1,1,1)};if(g){R(u,{position:x,scale:M});const f=g.matrixWorld.clone();if(g.matrixWorld.identity(),!m||typeof m=="number"){const t=new J;t.position.copy(u.position),t.lookAt(g.position),typeof m=="number"&&t.rotateZ(m),R(u,{rotation:t.rotation})}else R(u,{rotation:m});return O.geometry=new V(g,u.position,u.rotation,u.scale),j.current&&R(j.current,u),g.matrixWorld=f,()=>{O.geometry.dispose()}}},[a,...z(x),...z(M),...z(m)]),p.createElement("mesh",{ref:E},y||p.createElement("meshStandardMaterial",K({transparent:!0,polygonOffset:!0,polygonOffsetFactor:-10},B)),l&&p.createElement("mesh",{ref:j},p.createElement("boxGeometry",null),p.createElement("meshNormalMaterial",{wireframe:!0}),p.createElement("axesHelper",null)))}),et=p.forwardRef(({children:r,enabled:l=!0,speed:a=1,rotationIntensity:y=1,floatIntensity:x=1,floatingRange:m=[-.1,.1],...M},B)=>{const d=p.useRef(null),E=p.useRef(Math.random()*1e4);return Q(j=>{var g,O;if(!l||a===0)return;const u=E.current+j.clock.getElapsedTime();d.current.rotation.x=Math.cos(u/4*a)/8*y,d.current.rotation.y=Math.sin(u/4*a)/8*y,d.current.rotation.z=Math.sin(u/4*a)/20*y;let f=Math.sin(u/4*a)/10;f=Y.mapLinear(f,-.1,.1,(g=m==null?void 0:m[0])!==null&&g!==void 0?g:-.1,(O=m==null?void 0:m[1])!==null&&O!==void 0?O:.1),d.current.position.y=f*x,d.current.updateMatrix()}),p.createElement("group",M,p.createElement("group",{ref:v([d,B]),matrixAutoUpdate:!1},r))}),st=r=>{const[l]=W([r.imgUrl]);return H(et,{speed:1.75,rotationIntensity:1,floatIntensity:2,children:[G("ambientLight",{intensity:.25}),G("directionalLight",{position:[0,0,.05]}),H("mesh",{castShadow:!0,receiveShadow:!0,scale:1.25,children:[G("icosahedronGeometry",{args:[1,1]}),G("meshStandardMaterial",{color:"#fff8eb",polygonOffset:!0,polygonOffsetFactor:-5,flatShading:!0}),G(ot,{position:[0,0,1],rotation:[2*Math.PI,0,6.25],scale:1,map:l,flatShading:!0})]})]})};export{st as default};
